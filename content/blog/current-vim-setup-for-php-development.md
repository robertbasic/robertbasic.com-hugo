+++
draft = false
date = "2017-02-10T09:01:31+01:00"
title = "Current Vim setup for PHP development"
slug = "current-vim-setup-for-php-development"
description = "My current Vim setup for PHP development"
tags = ["php", "vim", "plugins", "gutentags", "phpstan", "ale", "phpctags", "tagbar", "linting", "completion", "phpcd", "namespaces"]
categories = ["Development", "Programming"]
2017 = ["02"]

+++

I made some changes to my Vim setup for PHP development recently, so it's time to write it all down. I'm more than sure that I'll break it soon and won't be able to remember all the things I did to have the current setup.

Some new plugins popped up on my radar, I tweaked some older plugins and I even wrote one for [PHPStan](https://github.com/phpstan/phpstan)!

Last year I wrote how I got really good [tag support in Vim](https://robertbasic.com/blog/tags-for-php-in-vim/), so I'll first expand on that.

## Gutentags

[Gutentags](https://github.com/ludovicchabant/vim-gutentags) is probably the plugin that had the biggest impact on my workflow. It made possible many other functionalities and plugins to just work.

First thing I have configured for it is the location for the tag files:
``` vim
" Where to store tag files
let g:gutentags_cache_dir = '~/.vim/gutentags'
```

The second is a more "aggressive" excluding of files from generating tags:

``` vim
let g:gutentags_exclude = ['*.css', '*.html', '*.js', '*.json', '*.xml',
                            \ '*.phar', '*.ini', '*.rst', '*.md',
                            \ '*vendor/*/test*', '*vendor/*/Test*',
                            \ '*vendor/*/fixture*', '*vendor/*/Fixture*',
                            \ '*var/cache*', '*var/log*']
```

Takes out a **lot** of rubbish.

I also have the following in the global `~/.ctags` configuration file (gutentags uses ctags under the hood to generate the tags):

``` bash
--PHP-kinds=+cfit-va
```

This way I get tags for classes, interfaces, functions, namespaces and traits, while variables and aliases are ignored to remove the noise level.

## Jump to definition

I paired CtrlP's `CtrlPTag` method with `gutentags` tag files to get jump to definition functionality:

``` vim
map <silent> <leader>jd :CtrlPTag<cr><C-\>w
```

My complete CtrlP settings are [here](https://github.com/robertbasic/vimstuff/blob/1b3a2b9483df999efd50e794550fa6ed434ef323/.vimrc#L223-L239).

## Current PHP class and method

A combination of three Vim plugins and a PHP phar file gives me the possibility to show in the status bar the current PHP class and method.

[Lightline](https://github.com/itchyny/lightline.vim) provides the status bar, [tagbar](https://github.com/majutsushi/tagbar) to get the current tag, [tagbar-phpctags](https://github.com/vim-php/tagbar-phpctags.vim) to generate the tags for the current file using [phpctags](https://github.com/vim-php/phpctags).

Use the following setting to tell `tagbar` about the `phpctags` binary:

``` vim
let g:tagbar_phpctags_bin='~/.vim/phpctags'
```

This is the `tagbar` line for `lightline`:

``` vim
'tagbar': '%{tagbar#currenttag("[%s]", "", "f")}',
```

See [here](https://github.com/robertbasic/vimstuff/blob/1b3a2b9483df999efd50e794550fa6ed434ef323/.vimrc#L292-L307) how it all fits together.

Now that I wrote it all down, I should take a look if I could use the `gutentags` tag files for this. Seems like an awful lot of moving parts for a relatively small feature.

## PHP namespaces

The [vim-php-namespace plugin](https://github.com/arnaud-lb/vim-php-namespace) provides support for inserting `use` statements in PHP code. It will use the tag files generated by `gutentags`, there's no need to set up anything for that.

I have the following mapping to insert the `use` statements:

``` vim
function! IPhpInsertUse()
    call PhpInsertUse()
    call feedkeys('a',  'n')
endfunction
autocmd FileType php inoremap <Leader>pnu <Esc>:call IPhpInsertUse()<CR>
autocmd FileType php noremap <Leader>pnu :call PhpInsertUse()<CR>
```

and this one for expanding classes to get their fully qualified names:

``` vim
function! IPhpExpandClass()
    call PhpExpandClass()
    call feedkeys('a', 'n')
endfunction
autocmd FileType php inoremap <Leader>pne <Esc>:call IPhpExpandClass()<CR>
autocmd FileType php noremap <Leader>pne :call PhpExpandClass()<CR>
```

I also let it to automatically sort the namespaces after inserting:

``` vim
let g:php_namespace_sort_after_insert=1
```

## Linting

[ALE is an Asynchronous Lint Engine](https://github.com/w0rp/ale) and it provides linting for Vim 8. It can do linting for a **bunch** of [languages](https://github.com/w0rp/ale#1-supported-languages-and-tools).

My configuration for it is:

``` vim
let g:ale_linters = {
\   'php': ['php'],
\}
let g:ale_lint_on_save = 1
let g:ale_lint_on_text_changed = 0
```

Lints PHP files on save, in the background. A must have!

## A promising completion engine for PHP

[php.cd](https://github.com/php-vim/phpcd.vim) finally provides useful completion for PHP. It's still rough around the edges, misses a feature or two, but I find it a lot better than any other completion engine I used before. No need to configure anything for it, just follow their installation instructions and that's it. `^X^O` all the things!

## PHPStan in Vim

[PHPStan](https://github.com/phpstan/phpstan) is a static analysis tool for PHP and I wrote a small plugin for it, [vim-phpstan](https://github.com/phpstan/vim-phpstan). It calls `phpstan` from Vim and populates Vim's quickfix list with the errors.

For now, the only possible configuration is to set the analyse level:

``` vim
let g:phpstan_analyse_level = 2
```

## Debugging

Sadly, there is no good PHP debugging client for Vim. Or none that I know of. There are a couple of them out there, but they seem long abandoned. I work on a standalone PHP debugging client, [pugdebug](https://github.com/robertbasic/pugdebug), but it has it's own set of problems as well (packaging on Linux is a nightmare).

## Supporting plugins

Other "supporting" plugins are [2072/PHP-Indenting-for-VIm](https://github.com/2072/PHP-Indenting-for-VIm), [2072/vim-syntax-for-PHP](https://github.com/2072/vim-syntax-for-PHP), [sirver/ultisnips](https://github.com/SirVer/ultisnips), plugins from the [sniphpets](https://github.com/sniphpets) organization, [ddrscott/vim-side-search](https://github.com/ddrscott/vim-side-search), [robertbasic/vim-argument-swapper](https://github.com/robertbasic/vim-argument-swapper).

I'm pretty happy with the current setup. Do you know maybe of any interesting plugin I'm missing? [Let me know](https://twitter.com/robertbasic)!

Happy hackin'!
